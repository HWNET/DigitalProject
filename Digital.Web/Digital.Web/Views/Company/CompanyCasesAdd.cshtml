@using Digital.WCFClient.ConfigService
@using System.Collections.ObjectModel
@using Digital.Common.Mvc.Extensions
@using Microsoft.AspNet.Identity
@model Digital.WCFClient.ConfigService.CasesModel
@{
    ViewBag.Title = "添加案例";
    Layout = "~/Views/Shared/_LayoutDigital.cshtml";
}
@section PageSpecificJavascriptIncludes{
    <link rel="stylesheet" href="../DigitalStyle/css/jquery.gritter.css" />
    <link rel="stylesheet" href="../DigitalStyle/css/bootstrap-fileupload.min.css" />
    <link rel="stylesheet" href="../DigitalStyle/css/jquery.tagsinput.css" />

    <script src="../DigitalStyle/js/jquery.autogrow-textarea.js"></script>
    <script src="../DigitalStyle/js/bootstrap-fileupload.min.js"></script>
    <script src="../DigitalStyle/js/jquery.maskedinput.min.js"></script>
    <script src="../DigitalStyle/js/jquery.tagsinput.min.js"></script>

    <script src="../DigitalStyle/js/jquery.gritter.min.js"></script>
    <script src="../DigitalStyle/js/jquery.validate.min.js"></script>
    <script src="../DigitalStyle/js/JqueryToken.js"></script>
    <script src="../DigitalStyle/js/messages_cn.js"></script>
    <!-- CKEditor -->
    <script src="../DigitalStyle/js/ckeditor/ckeditor.js"></script>
    <script src="../DigitalStyle/js/ckeditor/adapters/jquery.js"></script>
<script type="text/javascript" src="@Url.StaticFile("/DigitalStyle/js/flashupload.js")"></script>

}
<div class="pageheader">
    <h2><i class="fa fa-user"></i> 添加案例 <span>案例中心</span></h2>
    <div class="breadcrumb-wrapper">
        <span class="label">你的位置:</span>
        <ol class="breadcrumb">
            <li><a href="">企业中心</a></li>
            <li class="active">案例中心</li>
        </ol>
    </div>
</div>

<div class="contentpanel">
    <div class="row">

        <div class="col-sm-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <div class="panel-btns">
                        <a href="" class="minimize">&minus;</a>
                    </div><!-- panel-btns -->
                    <h3 class="panel-title">案例管理</h3>
                </div>


                <div class="panel-body panel-body-nopadding">
                    @Html.AntiForgeryToken()
                    <form class="form-horizontal form-bordered">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">案例名称</label>
                            <div class="col-sm-6">
                                <input type="text" id="Name" placeholder="项目名称" value="@Model.CasesName" class="form-control" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">概述</label>
                            <div class="col-sm-6">
                                <textarea id="Abstract" class="form-control" rows="5">@Model.CasesAbstract</textarea>
                            </div>
                        </div>



                        <div class="form-group">
                            <label class="col-sm-3 control-label">案例缩略图</label>
                            <div class="col-sm-6">
                                <div class="fileupload fileupload-new" data-provides="fileupload" id="container">
                                    <div class="input-append">
                                        <div class="uneditable-input">
                                            <i class="glyphicon glyphicon-file fileupload-exists"></i>
                                            <span id="filelist" class="fileupload-preview"></span>
                                        </div>
                                        <span class="btn btn-default btn-file">
                                            <span class="fileupload-new">上传缩略图</span>
                                            <input id="pickfiles" value="@Model.CasesThumbnail" type="file" />
                                        </span>
                                        <a href="#" id="uploadfiles" class="btn btn-default">上传</a>
                                    </div>
                                </div>
                                <input id="ImagePath" type="hidden" value="@Model.CasesThumbnail" />

                                <img id="PersonImage" src="@Html.IsNull(Model.CasesThumbnail, "../DigitalStyle/images/pic-none.png", Model.CasesThumbnail)" class="thumbnail img-responsive" alt="" />
                                @*<input id="ImagePath" type="hidden" value="@Model.CasesThumbnail" />
                                <div id="uploader"></div>
                                <img id="PersonImage" src="@Html.IsNull(Model.CasesThumbnail, "../DigitalStyle/images/pic-none.png", Model.CasesThumbnail)" class="thumbnail img-responsive" alt="" />*@
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-3 control-label">案例日期</label>
                            <div class="col-sm-4 ">
                                <div class="input-group">
                                    <input type="text" value="@Model.CasesDate" class="form-control" placeholder="mm/dd/yyyy" id="CasesDate">
                                    <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">所属分类</label>

                            <div class="col-sm-4 ">
                                <select id="CasesCategory" class="form-control chosen-select" data-placeholder="选择分类...">
                                   
                                </select>
                            </div>

                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">排序值</label>
                            <div class="col-sm-4">
                                <input type="text" id="OrderBy" placeholder="50" value="@Model.CasesOrderBy" class="form-control" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">标签</label>
                            <div class="col-sm-4">
                                <input name="tags" id="Labels" class="form-control" value="@Model.CasesLabels" />
                            </div>
                        </div>



                        <div class="form-group">
                            <label class="col-sm-3 control-label" for="checkbox">详细描述</label>
                            <div class="col-sm-6">
                                <textarea id="CasesDetails" name="CasesDetails" placeholder="请在此输入主题内容" class="form-control" rows="10">@Model.CasesDetails</textarea>
                            </div>
                        </div>
                    </form>
                </div>


                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3">
                            <button class="btn btn-primary" onclick="Save()">提交</button>&nbsp;
                            <button class="btn btn-default">取消</button>
                        </div>
                    </div>
                </div>
            </div><!-- panel -->
        </div>

    </div>
</div>

<script>
    function callback(msg)
    {
        $("#ImagePath").val(msg.msg.url);
        $("#PersonImage")[0].src = msg.msg.url;
    }
    jQuery(document).ready(function () {
                   $('#uploader').FileUpload({
                      
                       'subfolder': 'UserInfo' + '@Digital.Common.CryptoService.MD5Encrypt(User.Identity.GetUserId(),Digital.Common.SerurityType.UserInfoFolder)',
                       'ImageId': ''
                      
                   });
        var CasesCategoryjsons=@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject((List<BaseNameValueMode>)ViewBag.CasesCategory))
        DropOption(CasesCategoryjsons,$("#CasesCategory"),@Model.CasesCategoryID);

        // Chosen Select
        jQuery(".chosen-select").chosen({ 'width': '100%', 'white-space': 'nowrap' });

        // Tags Input
        jQuery('#Labels').tagsInput({ width: 'auto' });

        // Textarea Autogrow
        jQuery('#CasesDetails').autogrow();

        // Date Picker
        jQuery('#CasesDate').datepicker();

        jQuery('#CasesDate-inline').datepicker();

        jQuery('#CasesDate-multiple').datepicker({
            numberOfMonths: 3,
            showButtonPanel: true
        });

        // Input Masks
        jQuery("#date").mask("99/99/9999");
        jQuery("#phone").mask("(999) 999-9999");
        jQuery("#ssn").mask("999-99-9999");

    });
    function Save()
    {
        var Name = $("#Name").val();
        var Abstract = $("#Abstract").val();
        var Image = $("#ImagePath").val();
        var CasesDate = $("#CasesDate").val();
        var CasesCategory=$.jsparams.select("CasesCategory");
        var OrderBy= $("#OrderBy").val();
        var Labels=$("#Labels").val();
        var CasesDetails=$("#CasesDetails").val();
        @{
            var Ids = Request["Id"] == null ? "0" : Request["Id"].ToString();
        }
        var Id=@Ids;
        ComAjax("/Company/CompanyCasesAdd", {Id:Id, CName: Name, Abstract: Abstract, CImage: Image, CasesDate: CasesDate, CasesCategory: CasesCategory,OrderBy:OrderBy,Labels:Labels,CasesDetails:CasesDetails }, "添加案例");
    }
</script>
<script>
    jQuery(document).ready(function () {

        // CKEditor
        jQuery('textarea#CasesDetails').ckeditor();

        jQuery('#inlineedit1, #inlineedit2').ckeditor();

        // Uncomment the following code to test the "Timeout Loading Method".
        // CKEDITOR.loadFullCoreTimeout = 5;

        window.onload = function () {
            // Listen to the double click event.
            if (window.addEventListener)
                document.body.addEventListener('dblclick', onDoubleClick, false);
            else if (window.attachEvent)
                document.body.attachEvent('ondblclick', onDoubleClick);
        };

        function onDoubleClick(ev) {
            // Get the element which fired the event. This is not necessarily the
            // element to which the event has been attached.
            var element = ev.target || ev.srcElement;

            // Find out the div that holds this element.
            var name;

            do {
                element = element.parentNode;
            }
            while (element && (name = element.nodeName.toLowerCase()) &&
                (name != 'div' || element.className.indexOf('editable') == -1) && name != 'body');

            if (name == 'div' && element.className.indexOf('editable') != -1)
                replaceDiv(element);
        }

        var editor;

        function replaceDiv(div) {
            if (editor)
                editor.destroy();
            editor = CKEDITOR.replace(div);
        }

    });
</script>


